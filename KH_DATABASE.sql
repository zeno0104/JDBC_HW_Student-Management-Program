------------------------------------------------------
-- KH_UNIVERSITY CLEAN BUILD (Oracle)
-- Run as SCRIPT (F5). No N'' literals. Safe drops.
------------------------------------------------------

-- 1) SAFE DROPS (each in its own PL/SQL block)
BEGIN EXECUTE IMMEDIATE 'DROP TABLE KH_GRADE CASCADE CONSTRAINTS PURGE';
EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE KH_STUDENT CASCADE CONSTRAINTS PURGE';
EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE KH_SUBJECT CASCADE CONSTRAINTS PURGE';
EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE KH_PROFESSOR CASCADE CONSTRAINTS PURGE';
EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE KH_MAJOR CASCADE CONSTRAINTS PURGE';
EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;
/

------------------------------------------------------
-- 2) TABLES
------------------------------------------------------
-- KH_MAJOR
CREATE TABLE KH_MAJOR (
    MAJOR_CODE  VARCHAR2(10) PRIMARY KEY,
    MAJOR_NAME  NVARCHAR2(30) UNIQUE NOT NULL,
    OFFICE      NVARCHAR2(30),
    PHONE       VARCHAR2(15)
);

-- KH_PROFESSOR
CREATE TABLE KH_PROFESSOR (
    PROF_ID     VARCHAR2(10) PRIMARY KEY,
    PROF_NAME   NVARCHAR2(30) NOT NULL,
    MAJOR_CODE  VARCHAR2(10) NOT NULL,
    POSITION    NVARCHAR2(20) CHECK(POSITION IN ('교수, 부교수, 조교수'),
    EMAIL       VARCHAR2(50),
    PHONE       VARCHAR2(20),
    HIRE_DATE   DATE DEFAULT SYSDATE,
    CONSTRAINT FK_PROF_MAJOR FOREIGN KEY (MAJOR_CODE)
        REFERENCES KH_MAJOR(MAJOR_CODE)
        ON DELETE CASCADE
);
SELECT * FROM kh_professor;
-- KH_SUBJECT
CREATE TABLE KH_SUBJECT (
    SUBJECT_CODE  VARCHAR2(10) PRIMARY KEY,
    SUBJECT_NAME  NVARCHAR2(50) NOT NULL,
    MAJOR_CODE    VARCHAR2(10) NOT NULL,
    PROF_ID       VARCHAR2(10), -- ON DELETE SET NULL 하려면 NULL 허용
    CREDIT        NUMBER(1) DEFAULT 3 CHECK (CREDIT BETWEEN 1 AND 5),
    OPEN_YEAR     NUMBER(4) DEFAULT EXTRACT(YEAR FROM SYSDATE),
    SEMESTER      NUMBER(1) DEFAULT 1 CHECK (SEMESTER IN (1, 2)),
    CONSTRAINT FK_SUBJECT_MAJOR FOREIGN KEY (MAJOR_CODE)
        REFERENCES KH_MAJOR(MAJOR_CODE)
        ON DELETE CASCADE,
    CONSTRAINT FK_SUBJECT_PROF FOREIGN KEY (PROF_ID)
        REFERENCES KH_PROFESSOR(PROF_ID)
        ON DELETE SET NULL
);

-- KH_STUDENT
CREATE TABLE KH_STUDENT (
    STD_NO        VARCHAR2(8) PRIMARY KEY,
    STD_NAME      NVARCHAR2(20) NOT NULL,
    STD_AGE       NUMBER(3) NOT NULL CHECK (STD_AGE BETWEEN 17 AND 99),
    MAJOR_CODE    VARCHAR2(10), -- ON DELETE SET NULL과 일관
    ENT_DATE      DATE DEFAULT SYSDATE,
    STATUS        NVARCHAR2(10) DEFAULT '재학'
                  CHECK (STATUS IN ('재학', '휴학', '졸업', '제적')),
    CONSTRAINT FK_STUDENT_MAJOR FOREIGN KEY (MAJOR_CODE)
        REFERENCES KH_MAJOR(MAJOR_CODE)
        ON DELETE SET NULL
);

-- KH_GRADE
CREATE TABLE KH_GRADE (
    GRADE_ID      NUMBER PRIMARY KEY,
    STD_NO        VARCHAR2(8) NOT NULL,
    SUBJECT_CODE  VARCHAR2(10) NOT NULL,
    SCORE         NUMBER(3) CHECK (SCORE BETWEEN 0 AND 100),
    GRADE         NVARCHAR2(2),
    GPA           NUMBER(2,1),
    REG_DATE      DATE DEFAULT SYSDATE,
    CONSTRAINT FK_GRADE_STD FOREIGN KEY (STD_NO)
        REFERENCES KH_STUDENT(STD_NO)
        ON DELETE CASCADE,
    CONSTRAINT FK_GRADE_SUB FOREIGN KEY (SUBJECT_CODE)
        REFERENCES KH_SUBJECT(SUBJECT_CODE)
        ON DELETE CASCADE,
    CONSTRAINT UQ_GRADE_STD_SUB UNIQUE (STD_NO, SUBJECT_CODE)
);

------------------------------------------------------
-- 3) SEED DATA
------------------------------------------------------
-- MAJOR
INSERT INTO KH_MAJOR VALUES ('CS', '컴퓨터공학과', '공학관 301호', '02-1111-2222');
INSERT INTO KH_MAJOR VALUES ('BA', '경영학과',   '경영관 201호', '02-3333-4444');
INSERT INTO KH_MAJOR VALUES ('PS', '심리학과',   '인문관 105호', '02-5555-6666');
INSERT INTO KH_MAJOR VALUES ('NU', '간호학과',   '간호관 401호', '02-7777-8888');
INSERT INTO KH_MAJOR VALUES ('ME', '언론정보학과','미디어관 203호','02-9999-0000');
INSERT INTO KH_MAJOR VALUES ('PE', '체육학과',   '체육관 102호', '02-2222-3333');

-- PROFESSOR (IDs map to subjects below)
-- CS
INSERT INTO KH_PROFESSOR VALUES ('PR101', '이상훈', 'CS', '교수',     'sanghoon@univ.ac.kr', '010-1111-1111', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR102', '정유진', 'CS', '부교수',   'yujin@univ.ac.kr',    '010-2222-2222', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR103', '김민준', 'CS', '조교수',   'minjun@univ.ac.kr',   '010-3333-3333', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR104', '박하린', 'CS', '전임교수', 'harin@univ.ac.kr',    '010-4444-4444', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR105', '이재현', 'CS', '조교수',   'jaehyun@univ.ac.kr',  '010-5555-5555', DEFAULT);

-- BA
INSERT INTO KH_PROFESSOR VALUES ('PR201', '한지훈', 'BA', '조교수',   'jihoon@univ.ac.kr',   '010-6666-6666', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR202', '정민수', 'BA', '교수',     'minsu@univ.ac.kr',    '010-7777-7777', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR203', '김태민', 'BA', '부교수',   'taemin@univ.ac.kr',   '010-8888-8888', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR204', '박시은', 'BA', '전임교수', 'sieun@univ.ac.kr',    '010-9999-9999', DEFAULT);

-- PS
INSERT INTO KH_PROFESSOR VALUES ('PR301', '윤하린', 'PS', '부교수',   'harin_ps@univ.ac.kr', '010-1111-2222', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR302', '이하림', 'PS', '조교수',   'harim@univ.ac.kr',    '010-2222-3333', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR303', '정유진', 'PS', '교수',     'yujin_ps@univ.ac.kr', '010-3333-4444', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR304', '박민재', 'PS', '조교수',   'minjae@univ.ac.kr',   '010-4444-5555', DEFAULT);

-- NU
INSERT INTO KH_PROFESSOR VALUES ('PR401', '문예린', 'NU', '조교수',   'yerin@univ.ac.kr',    '010-6666-7777', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR402', '김하늘', 'NU', '부교수',   'haneul@univ.ac.kr',   '010-7777-8888', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR403', '이도연', 'NU', '교수',     'doyeon@univ.ac.kr',   '010-8888-9999', DEFAULT);

-- ME
INSERT INTO KH_PROFESSOR VALUES ('PR501', '정서윤', 'ME', '전임교수', 'seoyoon@univ.ac.kr',  '010-2222-3333', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR502', '이하준', 'ME', '조교수',   'hajun@univ.ac.kr',    '010-3333-4444', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR503', '홍지우', 'ME', '교수',     'jiwoo@univ.ac.kr',    '010-4444-5555', DEFAULT);

-- PE
INSERT INTO KH_PROFESSOR VALUES ('PR601', '이도윤', 'PE', '교수',     'doyoon@univ.ac.kr',   '010-7777-8888', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR602', '하도현', 'PE', '부교수',   'dohyun@univ.ac.kr',   '010-8888-9999', DEFAULT);
INSERT INTO KH_PROFESSOR VALUES ('PR603', '남유진', 'PE', '전임교수', 'yujin_pe@univ.ac.kr', '010-9999-0000', DEFAULT);

-- SUBJECT (uses PROF_ID, not name)
-- CS
INSERT INTO KH_SUBJECT VALUES ('CS101', '프로그래밍입문', 'CS', 'PR101', 3, 2024, 1);
INSERT INTO KH_SUBJECT VALUES ('CS102', '데이터베이스',   'CS', 'PR102', 3, 2024, 2);
INSERT INTO KH_SUBJECT VALUES ('CS103', '운영체제',       'CS', 'PR103', 3, 2025, 1);
INSERT INTO KH_SUBJECT VALUES ('CS104', '웹프로그래밍',   'CS', 'PR104', 3, 2025, 2);
INSERT INTO KH_SUBJECT VALUES ('CS105', '자료구조',       'CS', 'PR105', 3, 2024, 1);

-- BA
INSERT INTO KH_SUBJECT VALUES ('BA201', '경영학원론',     'BA', 'PR201', 3, 2023, 1);
INSERT INTO KH_SUBJECT VALUES ('BA202', '회계학개론',     'BA', 'PR202', 3, 2024, 1);
INSERT INTO KH_SUBJECT VALUES ('BA203', '마케팅기초',     'BA', 'PR203', 2, 2024, 2);
INSERT INTO KH_SUBJECT VALUES ('BA204', '인적자원관리',   'BA', 'PR204', 3, 2025, 1);

-- PS
INSERT INTO KH_SUBJECT VALUES ('PS301', '심리학개론',     'PS', 'PR301', 3, 2024, 1);
INSERT INTO KH_SUBJECT VALUES ('PS302', '발달심리학',     'PS', 'PR302', 3, 2024, 2);
INSERT INTO KH_SUBJECT VALUES ('PS303', '사회심리학',     'PS', 'PR303', 3, 2025, 1);
INSERT INTO KH_SUBJECT VALUES ('PS304', '심리통계학',     'PS', 'PR304', 2, 2025, 2);

-- NU
INSERT INTO KH_SUBJECT VALUES ('NU401', '기초간호학',     'NU', 'PR401', 3, 2024, 1);
INSERT INTO KH_SUBJECT VALUES ('NU402', '인체해부학',     'NU', 'PR402', 4, 2024, 2);
INSERT INTO KH_SUBJECT VALUES ('NU403', '간호윤리',       'NU', 'PR403', 3, 2025, 1);
INSERT INTO KH_SUBJECT VALUES ('NU404', '성인간호학',     'NU', 'PR401', 4, 2025, 2);

-- ME
INSERT INTO KH_SUBJECT VALUES ('ME501', '미디어개론',     'ME', 'PR501', 3, 2023, 1);
INSERT INTO KH_SUBJECT VALUES ('ME502', '디지털저널리즘', 'ME', 'PR502', 3, 2024, 2);
INSERT INTO KH_SUBJECT VALUES ('ME503', '광고홍보학',     'ME', 'PR503', 3, 2025, 1);
INSERT INTO KH_SUBJECT VALUES ('ME504', '영상콘텐츠제작', 'ME', 'PR502', 3, 2025, 2);

-- PE
INSERT INTO KH_SUBJECT VALUES ('PE601', '운동생리학',     'PE', 'PR601', 3, 2024, 1);
INSERT INTO KH_SUBJECT VALUES ('PE602', '스포츠심리학',   'PE', 'PR602', 3, 2024, 2);
INSERT INTO KH_SUBJECT VALUES ('PE603', '트레이닝방법론', 'PE', 'PR603', 3, 2025, 1);
INSERT INTO KH_SUBJECT VALUES ('PE604', '체육측정평가',   'PE', 'PR603', 3, 2025, 2);

-- STUDENT 
INSERT INTO KH_STUDENT VALUES ('20230001', '임서연', 22, 'CS', TO_DATE('2023-03-02','YYYY-MM-DD'), '재학');
INSERT INTO KH_STUDENT VALUES ('20230002', '조현우', 24, 'CS', TO_DATE('2022-03-02','YYYY-MM-DD'), '재학');
INSERT INTO KH_STUDENT VALUES ('20230003', '정유진', 23, 'BA', TO_DATE('2021-03-02','YYYY-MM-DD'), '휴학');
INSERT INTO KH_STUDENT VALUES ('20230004', '박도윤', 25, 'NU', TO_DATE('2020-03-02','YYYY-MM-DD'), '재학');
INSERT INTO KH_STUDENT VALUES ('20230005', '한예린', 21, 'ME', TO_DATE('2024-03-02','YYYY-MM-DD'), '재학');
INSERT INTO KH_STUDENT VALUES ('20230006', '이하준', 27, 'PE', TO_DATE('2021-09-02','YYYY-MM-DD'), '재학');
INSERT INTO KH_STUDENT VALUES ('20230007', '김민준', 22, 'PS', TO_DATE('2023-03-01','YYYY-MM-DD'), '재학');
INSERT INTO KH_STUDENT VALUES ('20230008', '오도윤', 23, 'PS', TO_DATE('2022-09-01','YYYY-MM-DD'), '재학');
INSERT INTO KH_STUDENT VALUES ('20230009', '서하늘', 24, 'BA', TO_DATE('2020-09-01','YYYY-MM-DD'), '졸업');
INSERT INTO KH_STUDENT VALUES ('20230010', '장유진', 26, 'ME', TO_DATE('2021-09-01','YYYY-MM-DD'), '재학');
INSERT INTO KH_STUDENT VALUES ('20230011', '박서연', 21, 'CS', TO_DATE('2024-03-01','YYYY-MM-DD'), '재학');
INSERT INTO KH_STUDENT VALUES ('20230012', '최수빈', 25, 'NU', TO_DATE('2020-03-10','YYYY-MM-DD'), '휴학');

-- GRADE (STD_NO/ SUBJECT_CODE 조합 유니크)
INSERT INTO KH_GRADE VALUES (1,  '20230001', 'CS101', 95, 'A',  4.0, SYSDATE);
INSERT INTO KH_GRADE VALUES (2,  '20230001', 'CS102', 89, 'B+', 3.5, SYSDATE);
INSERT INTO KH_GRADE VALUES (3,  '20230002', 'CS103', 92, 'A',  4.0, SYSDATE);
INSERT INTO KH_GRADE VALUES (4,  '20230003', 'BA201', 76, 'C+', 2.5, SYSDATE);
INSERT INTO KH_GRADE VALUES (5,  '20230004', 'NU401', 88, 'B+', 3.5, SYSDATE);
INSERT INTO KH_GRADE VALUES (6,  '20230005', 'ME501', 91, 'A',  4.0, SYSDATE);
INSERT INTO KH_GRADE VALUES (7,  '20230006', 'PE601', 97, 'A+', 4.5, SYSDATE);
INSERT INTO KH_GRADE VALUES (8,  '20230007', 'PS301', 83, 'B',  3.0, SYSDATE);
INSERT INTO KH_GRADE VALUES (9,  '20230008', 'PS302', 78, 'C+', 2.5, SYSDATE);
INSERT INTO KH_GRADE VALUES (10, '20230011', 'CS105', 88, 'B+', 3.5, SYSDATE);

COMMIT;
